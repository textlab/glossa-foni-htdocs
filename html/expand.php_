<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN"  "http://www.w3.org/TR/REC-html40/strict.dtd">
<html>
 <head>
<?php

//  $htmlRoot = 'http://omilia.uio.no/glossa/';
//  $cgiRoot = 'http://omilia.uio.no/cgi-bin/glossa/';

$id  = $_GET['line_key']; // the sql-table key for the segment returned by CQP
$size = $_GET['size']; // context width
$video = $_GET['video'];
$nested = $_GET['nested'];

#$table = $_GET['table'];
$corpus = $_GET['corpus'];

$conf = "/hf/foni/tekstlab/glossa-0.7/dat/nota/cgi.conf";

$file = fopen($conf, "r") or exit("Kan ikke åpne konfigurasjonsfila!");

while(!feof($file)){
    $line = fgets($file);
    if (ereg('^\#', $line)){ continue; }
    $split = split('=', $line);
    $conf_array[trim($split[0])] = trim($split[1]);
}
fclose($file);


$database = $conf_array["db_name"];
$user = $conf_array["db_uname"];
$pass = $conf_array["db_pwd"];
$dbhost = $conf_array["db_host"];

$table = strtoupper($corpus)."segments";

foreach ($conf_array as $key => $val){

    print("[$key] --- [$val]<br />");

}

if($size < 0){$size = 1;} // O makes no sense


/*
  $corpus = $_GET['corpus'];
  $uilang = $_GET['uilang'];
  $def_base_corpus = strtoupper($corpus);
  $subcorpus = $_GET['subcorpus'];
  include("glossa.inc");
*/

$session = mysql_connect ($dbhost, $user, $pass)
     or die ('I cannot connect to the database because: '
             . mysql_error());

mysql_select_db ($database, $session);

$mov = "SELECT audio_file FROM $table WHERE id = $id";

$lower_bound = $id - $size;
$upper_bound = $id + $size;

$context = "SELECT * FROM $table WHERE id >= " . $lower_bound . " AND id <= " . $upper_bound . ";"; 

print "CON: $context<br />";

$f = mysql_query($mov);

$arr = mysql_fetch_array($f);

print("<hr>" . $arr[0]  . "<hr>");

$res = mysql_query($context);
while($row=mysql_fetch_array($res)){

    /*

| id         | int(10) unsigned | YES  | MUL | NULL    |       |
| ref        | varchar(10)      | YES  |     | NULL    |       |
| audio_file | varchar(20)      | YES  |     | NULL    |       |
| begin      | varchar(10)      | YES  |     | NULL    |       |
| end        | varchar(10)      | YES  |     | NULL    |       |
| seg 

    */


  $id=$row["id"];
  $ref=$row["ref"];

  $audio_file=$row["audio_file"];
  $begin=$row["begin"];


  $end=$row["end"];
  $seg=$row["seg"];

  printf("<strong>%s</strong> - %s<br/>", $id,$ref);
  printf("<strong>%s</strong> - %s<br/>", $audio_file,$begin);
  printf("<strong>%s</strong> - %s<br/>", $end,$seg);
}
?>
